<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø£Ø¯Ø§Ø© Ø§Ù„Ù†Ø´Ø± ÙÙŠ Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„ÙÙŠØ³Ø¨ÙˆÙƒ</title>
    <style>
        /* --- Ù†ÙØ³ ÙƒÙˆØ¯ CSS Ø§Ù„Ø°ÙŠ Ù‚Ø¯Ù…ØªÙ‡ ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© --- */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f2f5;
            color: #1c1e21;
        }
        .container {
            max-width: 800px;
            margin: 20px auto; /* Added top/bottom margin */
            background-color: #fff;
            padding: 30px; /* Increased padding */
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); /* Enhanced shadow */
        }
        h1 {
            color: #1877f2;
            text-align: center;
            margin-bottom: 30px; /* Increased margin */
        }
        .form-group {
            margin-bottom: 20px; /* Increased margin */
        }
        label {
            display: block;
            margin-bottom: 8px; /* Increased margin */
            font-weight: bold;
            color: #4b4f56; /* Slightly darker label color */
        }
        input[type="text"],
        input[type="password"],
        input[type="number"],
        input[type="date"],
        input[type="time"],
        input[type="file"], /* Added file input styling */
        select,
        textarea {
            width: 100%;
            padding: 12px; /* Increased padding */
            border: 1px solid #dddfe2;
            border-radius: 6px; /* Slightly larger radius */
            box-sizing: border-box;
            font-size: 14px; /* Consistent font size */
            transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        input[type="text"]:focus,
        input[type="password"]:focus,
        input[type="number"]:focus,
        input[type="date"]:focus,
        input[type="time"]:focus,
        input[type="file"]:focus,
        select:focus,
        textarea:focus {
            border-color: #1877f2;
            box-shadow: 0 0 0 2px rgba(24, 119, 242, 0.2);
            outline: none;
        }
        textarea {
            height: 150px;
            resize: vertical;
        }
        .row {
            display: flex;
            gap: 15px; /* Increased gap */
            flex-wrap: wrap; /* Allow wrapping on smaller screens */
        }
        .col {
            flex: 1;
            min-width: 150px; /* Minimum width for columns */
        }
        button {
            background-color: #1877f2;
            color: white;
            border: none;
            padding: 10px 20px; /* Adjusted padding */
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            transition: background-color 0.2s ease-in-out, opacity 0.2s ease-in-out;
        }
        button:hover {
            background-color: #166fe5;
        }
        button:disabled {
            background-color: #bcc0c4; /* Disabled button style */
            cursor: not-allowed;
            opacity: 0.7;
        }
        #loadGroups, #startLoadingBtn {
             margin-top: 5px;
        }
        .groups-container {
            max-height: 350px; /* Increased height */
            overflow-y: auto;
            border: 1px solid #dddfe2;
            padding: 15px;
            margin-top: 10px; /* Added margin top */
            margin-bottom: 15px;
            border-radius: 6px;
            background-color: #f5f6f7; /* Light background for contrast */
        }
        .group-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px; /* Increased margin */
            padding: 5px;
            border-radius: 4px;
            transition: background-color 0.1s ease;
        }
        .group-item:hover {
             background-color: #ebedf0;
        }
        .group-item label {
            margin-bottom: 0; /* Override default label margin */
            margin-right: 8px; /* Space between checkbox and label */
            font-weight: normal; /* Normal weight for group names */
            color: #1c1e21;
            cursor: pointer;
            flex-grow: 1; /* Allow label to take remaining space */
        }
        .group-item input[type="checkbox"] {
             width: auto; /* Override default width */
             margin-left: 5px; /* Margin for RTL */
             cursor: pointer;
        }
        .status {
            margin-top: 20px;
            padding: 12px 15px; /* Adjusted padding */
            border-radius: 6px;
            display: none; /* Initially hidden */
            font-size: 14px;
            border: 1px solid transparent;
        }
        .status.info { /* Added info style */
             background-color: #e7f3ff;
             color: #1877f2;
             border-color: #bde0ff;
             display: block;
        }
        .status.success {
            background-color: #d4edda; /* Green success */
            color: #155724;
            border-color: #c3e6cb;
            display: block;
        }
        .status.error {
            background-color: #f8d7da; /* Red error */
            color: #721c24;
            border-color: #f5c6cb;
            display: block;
        }
        .status.warning {
            background-color: #fff3cd; /* Yellow warning */
            color: #856404;
            border-color: #ffeeba;
            display: block;
        }
        .schedule-options {
            display: none;
            margin-top: 15px;
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #eee;
        }
         .schedule-options label {
            margin-top: 10px;
        }
         .schedule-options input[type="date"],
         .schedule-options input[type="time"] {
            margin-bottom: 10px;
        }
        #uploadedImage {
            max-width: 100%;
            max-height: 200px; /* Limit preview height */
            display: none;
            margin-top: 15px;
            border-radius: 6px;
            border: 1px solid #dddfe2;
        }
        .progress-container {
            margin-top: 25px;
            display: none; /* Initially hidden */
        }
        .progress-bar {
            width: 100%;
            background-color: #e9ebee; /* Lighter background */
            border-radius: 6px;
            height: 20px;
            position: relative;
            overflow: hidden;
        }
        .progress {
            position: absolute;
            height: 100%;
            background-color: #1877f2;
            width: 0%;
            transition: width 0.3s ease-out; /* Smoother transition */
            border-radius: 6px 0 0 6px; /* Match parent radius */
        }
        .progress-info {
            margin-top: 8px;
            text-align: center;
            font-size: 13px;
            color: #606770;
        }
        .timer-display {
            background-color: #e7f3ff; /* Info color background */
            padding: 10px;
            border-radius: 6px;
            margin-top: 15px;
            text-align: center;
            font-size: 16px; /* Slightly smaller */
            font-weight: bold;
            display: none; /* Initially hidden */
            color: #1877f2;
            border: 1px solid #bde0ff;
        }
        .group-actions {
            margin-top: 10px;
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .group-actions button {
             background-color: #e4e6eb; /* Lighter buttons for actions */
             color: #050505;
             padding: 8px 15px; /* Smaller padding */
        }
        .group-actions button:hover {
             background-color: #d8dade;
        }
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center; /* Vertically align items */
            gap: 5px;
            margin-top: 20px; /* Increased margin */
            flex-wrap: wrap; /* Allow wrapping */
        }
        .page-btn {
            background-color: #e4e6eb;
            color: #050505;
            border: none;
            padding: 8px 12px; /* Adjusted padding */
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            min-width: 35px; /* Minimum width */
            text-align: center;
            transition: background-color 0.2s ease, color 0.2s ease;
        }
        .page-btn:hover {
            background-color: #d8dade;
        }
        .page-btn.active {
            background-color: #1877f2;
            color: white;
            font-weight: bold;
        }
        .page-btn:disabled {
             background-color: #f0f2f5;
             color: #bcc0c4;
             cursor: not-allowed;
        }
        .pagination span { /* Style for ellipsis */
            padding: 5px;
            color: #606770;
        }
        .group-counter {
            margin-top: 10px; /* Adjusted margin */
            font-size: 14px;
            color: #606770; /* Standard grey */
        }
        .filter-input {
            margin-bottom: 15px;
            padding: 10px;
            width: 100%;
            box-sizing: border-box;
            border-radius: 6px;
            border: 1px solid #dddfe2;
        }
        .loading {
            text-align: center;
            padding: 30px 20px; /* Increased padding */
            color: #606770;
        }
        .spinner {
            display: inline-block;
            width: 35px; /* Slightly larger */
            height: 35px;
            border: 4px solid rgba(24, 119, 242, 0.2); /* Thicker border, lighter alpha */
            border-radius: 50%;
            border-top-color: #1877f2;
            animation: spin 0.8s linear infinite; /* Faster spin */
            margin-bottom: 10px; /* Space below spinner */
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        #stopBtn { /* Specific style for stop button */
            background-color: #fa3e3e; /* Brighter red */
        }
        #stopBtn:hover {
             background-color: #e02c2c; /* Darker red on hover */
        }
        .security-options label { /* Style labels next to checkboxes */
             display: inline-block;
             margin-right: 5px;
             margin-bottom: 0;
             font-weight: normal;
             vertical-align: middle;
        }
         .security-options input[type="checkbox"] {
             width: auto;
             vertical-align: middle;
             margin-left: 10px; /* Space after checkbox (RTL) */
        }

    </style>
</head>
<body>
    <div class="container">
        <h1>Ø£Ø¯Ø§Ø© Ø§Ù„Ù†Ø´Ø± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙÙŠ Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„ÙÙŠØ³Ø¨ÙˆÙƒ</h1>
         <div class="status warning" style="display:block; border-color:#ffeeba;">
            <strong>ØªØ­Ø°ÙŠØ± Ù‡Ø§Ù…:</strong> Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø¯Ø§Ø© Ø¨Ø´ÙƒÙ„ Ù…ÙƒØ«Ù Ø£Ùˆ ØºÙŠØ± Ù…Ø³Ø¤ÙˆÙ„ Ù‚Ø¯ ÙŠØ¤Ø¯ÙŠ Ø¥Ù„Ù‰ ØªÙ‚ÙŠÙŠØ¯ Ø£Ùˆ Ø­Ø¸Ø± Ø­Ø³Ø§Ø¨Ùƒ Ø¹Ù„Ù‰ ÙÙŠØ³Ø¨ÙˆÙƒ. Ø§Ø³ØªØ®Ø¯Ù…Ù‡Ø§ Ø¨Ø­Ø°Ø± ÙˆØ¹Ù„Ù‰ Ù…Ø³Ø¤ÙˆÙ„ÙŠØªÙƒ Ø§Ù„ÙƒØ§Ù…Ù„Ø©. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø³ÙŠØ§Ø³Ø§Øª ÙÙŠØ³Ø¨ÙˆÙƒ.
        </div>

        <div class="form-group">
            <label for="accessToken">Ø±Ù…Ø² ÙˆØµÙˆÙ„ ÙÙŠØ³Ø¨ÙˆÙƒ (Access Token):</label>
            <input type="password" id="accessToken" placeholder="Ø§Ù„ØµÙ‚ Ø±Ù…Ø² Ø§Ù„ÙˆØµÙˆÙ„ Ù‡Ù†Ø§ (ÙŠØ¬Ø¨ Ø£Ù† ÙŠØªØ¶Ù…Ù† Ø£Ø°ÙˆÙ†Ø§Øª Ø§Ù„Ù†Ø´Ø± ÙÙŠ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª)">
            <small style="color: #dc3545; display: block; margin-top: 5px;">ØªÙ†Ø¨ÙŠÙ‡: Ù„Ø§ ØªØ´Ø§Ø±Ùƒ Ø±Ù…Ø² Ø§Ù„ÙˆØµÙˆÙ„ Ù‡Ø°Ø§ Ø£Ø¨Ø¯Ø§Ù‹. Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­.</small>
        </div>

        <div class="form-group">
            <label>Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„ÙÙŠØ³Ø¨ÙˆÙƒ:</label>
            <button id="loadGroups">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª</button>
            <div id="groupLoadingOptions" style="display: none; margin-top: 10px; background: #f9f9f9; padding: 15px; border-radius: 6px; border: 1px solid #eee;">
                <div class="row">
                    <div class="col">
                        <label for="loadLimit">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ù„Ù„ØªØ­Ù…ÙŠÙ„:</label>
                        <select id="loadLimit">
                            <option value="25">25 Ù…Ø¬Ù…ÙˆØ¹Ø©</option>
                            <option value="50">50 Ù…Ø¬Ù…ÙˆØ¹Ø©</option>
                            <option value="100">100 Ù…Ø¬Ù…ÙˆØ¹Ø©</option>
                            <option value="250" selected>250 Ù…Ø¬Ù…ÙˆØ¹Ø©</option>
                            <option value="500">500 Ù…Ø¬Ù…ÙˆØ¹Ø©</option>
                            <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª (Ù‚Ø¯ ÙŠØ³ØªØºØ±Ù‚ ÙˆÙ‚ØªØ§Ù‹ Ø·ÙˆÙŠÙ„Ø§Ù‹)</option>
                        </select>
                    </div>
                    <div class="col" style="align-self: flex-end;">
                        <button id="startLoadingBtn">Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„</button>
                    </div>
                </div>
            </div>

            <div id="groupSearchContainer" style="display: none; margin-top: 15px;">
                 <label for="groupFilter">Ø¨Ø­Ø« ÙˆØªØµÙÙŠØ© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª:</label>
                <input type="text" id="groupFilter" class="filter-input" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ù…Ø¬Ù…ÙˆØ¹Ø© Ù„Ù„Ø¨Ø­Ø«...">
                <div class="group-actions">
                    <button id="selectAllGroups">ØªØ­Ø¯ÙŠØ¯ ÙƒÙ„ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø©</button>
                    <button id="deselectAllGroups">Ø¥Ù„ØºØ§Ø¡ ØªØ­Ø¯ÙŠØ¯ ÙƒÙ„ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø©</button>
                    <!-- <button id="selectFilteredGroups">ØªØ­Ø¯ÙŠØ¯ ÙƒÙ„ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ù…ÙÙ„ØªØ±Ø© (Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ù…Ø±Ø¨ÙƒØ§Ù‹)</button> -->
                </div>
                <div class="group-counter" id="groupCounter"></div>
            </div>

            <div class="groups-container" id="groupsContainer">
                <p>Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª" Ø¨Ø¹Ø¯ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ÙˆØµÙˆÙ„.</p>
            </div>

            <div class="pagination" id="groupsPagination"></div>
        </div>

        <hr style="border: none; border-top: 1px solid #eee; margin: 30px 0;">

        <div class="form-group">
            <label for="postContent">Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù†Ø´ÙˆØ±:</label>
            <textarea id="postContent" placeholder="Ø§ÙƒØªØ¨ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ù‡Ù†Ø§... ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… {Ø§Ø³Ù…_Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©} Ù„ÙŠØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡ Ø¨Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ø´Ø±."></textarea>
             <small style="color: #606770; display: block; margin-top: 5px;">Ø§Ø³ØªØ®Ø¯Ù… `{Ø§Ø³Ù…_Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©}` ÙÙŠ Ø§Ù„Ù†Øµ Ù„ÙŠØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡ Ø¨Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ (Ø¥Ø°Ø§ Ø£Ø±Ø¯Øª).</small>
        </div>

        <div class="form-group">
            <label for="imageUpload">Ø¥Ø±ÙØ§Ù‚ ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
            <input type="file" id="imageUpload" accept="image/png, image/jpeg, image/gif">
            <img id="uploadedImage" src="" alt="Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø±ÙÙ‚Ø©">
        </div>

        <div class="form-group">
            <label for="postType">Ù†ÙˆØ¹ Ø§Ù„Ù†Ø´Ø±:</label>
            <select id="postType">
                <option value="now" selected>Ù†Ø´Ø± Ø§Ù„Ø¢Ù†</option>
                <option value="schedule">Ø¬Ø¯ÙˆÙ„Ø© Ø¨Ø¯Ø¡ Ø§Ù„Ù†Ø´Ø±</option>
            </select>

            <div class="schedule-options" id="scheduleOptions">
                <p style="font-size: 14px; color: #1c1e21;">Ø³ÙŠØªÙ… Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ù†Ø´Ø± ÙÙŠ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© (Ù…Ø¹ Ø§Ù„ÙÙˆØ§ØµÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠØ©) ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ØªØ§Ù„ÙŠ:</p>
                <label for="scheduleDate">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡:</label>
                <input type="date" id="scheduleDate">
                <label for="scheduleTime">ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø¡:</label>
                <input type="time" id="scheduleTime">
                 <small style="color: #606770; display: block; margin-top: 5px;">Ù…Ù„Ø§Ø­Ø¸Ø©: ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠ Ø¨ÙØ§Ø±Ù‚ 10 Ø¯Ù‚Ø§Ø¦Ù‚ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.</small>
            </div>
        </div>

        <div class="form-group">
            <label>Ø§Ù„ÙØ§ØµÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ Ø¨ÙŠÙ† ÙƒÙ„ Ù…Ù†Ø´ÙˆØ± ÙˆØ§Ù„Ø¢Ø®Ø± (Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚):</label>
            <div class="row">
                <div class="col">
                    <label for="minInterval">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰:</label>
                    <input type="number" id="minInterval" value="15" min="5">
                </div>
                <div class="col">
                    <label for="maxInterval">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰:</label>
                    <input type="number" id="maxInterval" value="30" min="10">
                </div>
            </div>
            <p style="font-size: 13px; color: #606770; margin-top: 5px;">Ø³ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± ÙØªØ±Ø© Ø²Ù…Ù†ÙŠØ© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ø¨ÙŠÙ† Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ ÙˆØ§Ù„Ø£Ù‚ØµÙ‰ Ø¨ÙŠÙ† ÙƒÙ„ Ù…Ù†Ø´ÙˆØ± Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ø­Ø¸Ø±. (Ù†Ù†ØµØ­ Ø¨Ù€ 15-30 Ø¯Ù‚ÙŠÙ‚Ø© Ø£Ùˆ Ø£ÙƒØ«Ø±).</p>
        </div>

        <div class="form-group">
            <label for="postingMode">ØªØ±ØªÙŠØ¨ Ø§Ù„Ù†Ø´Ø± ÙÙŠ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª:</label>
            <select id="postingMode">
                <option value="sequential" selected>Ù…ØªØªØ§Ø¨Ø¹ (Ø¨Ù†ÙØ³ ØªØ±ØªÙŠØ¨ Ø¸Ù‡ÙˆØ±Ù‡Ø§ Ø£Ùˆ ÙÙ„ØªØ±ØªÙ‡Ø§)</option>
                <option value="random">Ø¹Ø´ÙˆØ§Ø¦ÙŠ (Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø¨ØªØ±ØªÙŠØ¨ Ø¹Ø´ÙˆØ§Ø¦ÙŠ)</option>
            </select>
        </div>

        <div class="form-group security-options">
            <label>Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù† (Ù…ÙÙˆØµÙ‰ Ø¨Ù‡Ø§):</label>
            <div>
                <input type="checkbox" id="pauseOption" checked>
                <label for="pauseOption">Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª Ù„Ù…Ø¯Ø© 60 Ø¯Ù‚ÙŠÙ‚Ø© Ø¨Ø¹Ø¯ ÙƒÙ„ 5 Ù…Ù†Ø´ÙˆØ±Ø§Øª</label>
            </div>
            <div>
                <input type="checkbox" id="randomizeContent">
                <label for="randomizeContent">Ù…Ø­Ø§ÙˆÙ„Ø© ØªÙ†ÙˆÙŠØ¹ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù†ØµÙŠ Ù‚Ù„ÙŠÙ„Ø§Ù‹ (Ø¥Ø¶Ø§ÙØ© Ø±Ù…ÙˆØ² ØºÙŠØ± Ù…Ø±Ø¦ÙŠØ©)</label>
            </div>
        </div>

        <hr style="border: none; border-top: 1px solid #eee; margin: 30px 0;">

        <button id="publishBtn">ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„Ù†Ø´Ø± / Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø©</button>
        <button id="stopBtn" style="display: none;">ğŸ›‘ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù†Ø´Ø± ÙÙˆØ±Ø§Ù‹</button>

        <div class="progress-container" id="progressContainer">
            <div class="progress-bar">
                <div class="progress" id="progressBar"></div>
            </div>
            <div class="progress-info" id="progressInfo">0 Ù…Ù† 0 Ù…Ø¬Ù…ÙˆØ¹Ø§Øª</div>
            <div class="timer-display" id="timerDisplay">Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±: 00:00</div>
        </div>

        <div class="status" id="statusMessage"></div>

    </div>

    <script>
        // --- Ø¹Ù†Ø§ØµØ± DOM ---
        const accessTokenInput = document.getElementById('accessToken');
        const loadGroupsBtn = document.getElementById('loadGroups');
        const groupLoadingOptions = document.getElementById('groupLoadingOptions');
        const loadLimitSelect = document.getElementById('loadLimit');
        const startLoadingBtn = document.getElementById('startLoadingBtn');
        const groupsContainer = document.getElementById('groupsContainer');
        const groupsPagination = document.getElementById('groupsPagination');
        const groupSearchContainer = document.getElementById('groupSearchContainer');
        const groupFilterInput = document.getElementById('groupFilter');
        const selectAllBtn = document.getElementById('selectAllGroups');
        const deselectAllBtn = document.getElementById('deselectAllGroups');
        // const selectFilteredBtn = document.getElementById('selectFilteredGroups'); // Ø£Ø¨Ù‚ÙŠØªÙ‡ Ù…Ø¹Ù„Ù‚Ù‹Ø§ Ù„Ø£Ù†Ù‡ Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ù…Ø±Ø¨ÙƒÙ‹Ø§
        const groupCounter = document.getElementById('groupCounter');
        const postContentInput = document.getElementById('postContent');
        const imageUpload = document.getElementById('imageUpload');
        const uploadedImage = document.getElementById('uploadedImage');
        const postTypeSelect = document.getElementById('postType');
        const scheduleOptions = document.getElementById('scheduleOptions');
        const scheduleDateInput = document.getElementById('scheduleDate');
        const scheduleTimeInput = document.getElementById('scheduleTime');
        const minIntervalInput = document.getElementById('minInterval');
        const maxIntervalInput = document.getElementById('maxInterval');
        const postingModeSelect = document.getElementById('postingMode');
        const pauseOptionCheckbox = document.getElementById('pauseOption');
        const randomizeContentCheckbox = document.getElementById('randomizeContent');
        const publishBtn = document.getElementById('publishBtn');
        const stopBtn = document.getElementById('stopBtn');
        const statusMessage = document.getElementById('statusMessage');
        const progressContainer = document.getElementById('progressContainer');
        const progressBar = document.getElementById('progressBar');
        const progressInfo = document.getElementById('progressInfo');
        const timerDisplay = document.getElementById('timerDisplay');

        // --- Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø­Ø§Ù„Ø© ---
        let isPosting = false;
        let currentlySelectedGroupsForPosting = []; // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„Ù†Ø´Ø±
        let currentGroupIndex = 0;
        let postCountSincePause = 0;
        let stopPostingFlag = false;
        let timeoutId = null;
        let countdownInterval = null;

        let allGroups = []; // ÙŠØ®Ø²Ù† ÙƒÙ„ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„ØªÙŠ ØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡Ø§
        let filteredGroups = []; // ÙŠØ®Ø²Ù† Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„ÙÙ„ØªØ±Ø©
        let currentVisibleGroups = []; // ÙŠØ®Ø²Ù† Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ø¸Ø§Ù‡Ø±Ø© ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        let currentPage = 1;
        const groupsPerPage = 20;
        let isLoadingGroups = false;
        const API_VERSION = 'v19.0';

        // --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ---

        function showStatus(message, type = 'info') {
            statusMessage.innerHTML = message; // Use innerHTML to allow basic formatting like <strong>
            statusMessage.className = `status ${type}`;
            statusMessage.style.display = 'block';
            // Scroll into view if it's an error or warning
            if (type === 'error' || type === 'warning') {
                statusMessage.scrollIntoView({ behavior: 'smooth', block: 'end' });
            }
        }

        function updateProgress(current, total) {
            const percentage = total > 0 ? (current / total) * 100 : 0;
            progressBar.style.width = `${percentage}%`;
            progressInfo.textContent = `Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© ${current} Ù…Ù† ${total}`;
        }

        function startCountdownTimer(seconds) {
            clearInterval(countdownInterval);
            timerDisplay.style.display = 'block';
            let remainingSeconds = Math.max(0, seconds); // Ensure non-negative

            const updateTimer = () => {
                const totalMinutes = Math.floor(remainingSeconds / 60);
                const hrs = Math.floor(totalMinutes / 60);
                const mins = totalMinutes % 60;
                const secs = remainingSeconds % 60;

                let displayString = "Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±: ";
                if (hrs > 0) {
                    displayString += `${String(hrs).padStart(2, '0')}:`;
                }
                displayString += `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;

                timerDisplay.textContent = displayString;
                if (remainingSeconds <= 0) {
                    clearInterval(countdownInterval);
                    timerDisplay.style.display = 'none';
                }
                remainingSeconds--;
            };

            updateTimer();
            countdownInterval = setInterval(updateTimer, 1000);
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function disableForm(disabled) {
            publishBtn.disabled = disabled;
            accessTokenInput.disabled = disabled;
            loadGroupsBtn.disabled = disabled;
            startLoadingBtn.disabled = disabled; // Also disable this if loading is in progress
            postContentInput.disabled = disabled;
            imageUpload.disabled = disabled;
            postTypeSelect.disabled = disabled;
            scheduleDateInput.disabled = disabled;
            scheduleTimeInput.disabled = disabled;
            minIntervalInput.disabled = disabled;
            maxIntervalInput.disabled = disabled;
            postingModeSelect.disabled = disabled;
            pauseOptionCheckbox.disabled = disabled;
            randomizeContentCheckbox.disabled = disabled;
            // Don't disable group selection buttons/filter while posting, maybe user wants to prepare next batch
            // groupFilterInput.disabled = disabled;
            // selectAllBtn.disabled = disabled;
            // deselectAllBtn.disabled = disabled;
        }

        // --- ÙˆØ¸Ø§Ø¦Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª ---

        loadGroupsBtn.addEventListener('click', function() {
            const token = accessTokenInput.value;
            if (!token) {
                showStatus('<strong>Ø®Ø·Ø£:</strong> ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ÙˆØµÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹.', 'error');
                accessTokenInput.focus();
                return;
            }
            groupLoadingOptions.style.display = 'block';
            groupsContainer.innerHTML = '<p>Ø§Ø®ØªØ± Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø«Ù… Ø§Ø¶ØºØ· "Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„".</p>';
            groupSearchContainer.style.display = 'none';
            groupsPagination.innerHTML = '';
            groupCounter.textContent = '';
            allGroups = []; // Reset groups on new load attempt
            filteredGroups = [];
            currentVisibleGroups = [];
        });

        startLoadingBtn.addEventListener('click', async function() {
            const token = accessTokenInput.value;
            if (!token) {
                showStatus('<strong>Ø®Ø·Ø£:</strong> Ø±Ù…Ø² Ø§Ù„ÙˆØµÙˆÙ„ Ù…ÙÙ‚ÙˆØ¯.', 'error'); return;
            }
            if (isLoadingGroups) return;

            const limitOption = loadLimitSelect.value;
            const limit = limitOption === 'all' ? Infinity : parseInt(limitOption);

            isLoadingGroups = true;
            startLoadingBtn.disabled = true;
            loadGroupsBtn.disabled = true;
            showStatus('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ù…Ù† ÙÙŠØ³Ø¨ÙˆÙƒ...', 'info');
            groupsContainer.innerHTML = '<div class="loading"><div class="spinner"></div><p>ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±ØŒ Ù‚Ø¯ ÙŠØ³ØªØºØ±Ù‚ Ø§Ù„Ø£Ù…Ø± Ø¨Ø¹Ø¶ Ø§Ù„ÙˆÙ‚Øª...</p></div>';
            allGroups = [];
            filteredGroups = [];
            currentVisibleGroups = [];
            currentPage = 1;
            groupCounter.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...';
            groupsPagination.innerHTML = ''; // Clear pagination

            try {
                await fetchAllGroups(token, limit);
                showStatus(`ØªÙ… ØªØ­Ù…ÙŠÙ„ ${allGroups.length} Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¨Ù†Ø¬Ø§Ø­! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØ­Ø¯ÙŠØ¯.`, 'success');
                groupCounter.textContent = `ØªÙ… ØªØ­Ù…ÙŠÙ„ ${allGroups.length} Ù…Ø¬Ù…ÙˆØ¹Ø©.`;
                groupSearchContainer.style.display = 'block';
                updateFilteredGroups(); // Initial filter/display
                showPage(1);
            } catch (error) {
                console.error("Error loading groups:", error);
                showStatus(`<strong>ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª:</strong> ${error.message}. ØªØ£ÙƒØ¯ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø±Ù…Ø² ÙˆØ§Ù„Ø£Ø°ÙˆÙ†Ø§Øª.`, 'error');
                groupsContainer.innerHTML = `<p style="color: red;">Ø­Ø¯Ø« Ø®Ø·Ø£: ${error.message}</p>`;
                groupCounter.textContent = 'ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„';
            } finally {
                isLoadingGroups = false;
                startLoadingBtn.disabled = false;
                loadGroupsBtn.disabled = false;
            }
        });

        async function fetchAllGroups(token, maxLimit) {
            let groups = [];
            // Request permissions field to potentially filter later, although reliable filtering is hard client-side
            let url = `https://graph.facebook.com/${API_VERSION}/me/groups?fields=id,name,privacy,permissions&limit=100&access_token=${token}`;
            let count = 0;
            let fetchedCount = 0; // Count groups actually returned by API

            while (url && groups.length < maxLimit) {
                try {
                    const response = await fetch(url);
                    const data = await response.json();

                    if (data.error) {
                        // Handle specific errors if needed
                         if (data.error.code === 190) { // Auth errors
                              throw new Error(`Ù…ØµØ§Ø¯Ù‚Ø© ÙØ§Ø´Ù„Ø©: ${data.error.message} (ØªØ£ÙƒØ¯ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø±Ù…Ø²).`);
                         } else if (data.error.code === 10) { // Permission errors
                             throw new Error(`Ø®Ø·Ø£ Ø£Ø°ÙˆÙ†Ø§Øª: ${data.error.message} (ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ø±Ù…Ø² Ù„Ø¯ÙŠÙ‡ Ø¥Ø°Ù† 'groups_access_member_info').`);
                         } else {
                             throw new Error(`Ø®Ø·Ø£ API (${data.error.code}): ${data.error.message}`);
                         }
                    }

                    if (data.data && data.data.length > 0) {
                        fetchedCount += data.data.length;
                        // Add groups fetched in this page, respecting the overall maxLimit
                        const remainingLimit = maxLimit - groups.length;
                        const groupsToAdd = data.data.slice(0, remainingLimit);
                        groups.push(...groupsToAdd);

                        groupCounter.textContent = `Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª... (${groups.length} ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„ÙŠÙ‡Ø§)`;
                    } else {
                        break; // No more data
                    }

                    // Check for next page, only if we haven't hit the limit
                    if (groups.length < maxLimit && data.paging && data.paging.next) {
                        url = data.paging.next;
                    } else {
                        url = null; // Stop if limit reached or no next page
                    }

                } catch (error) {
                    console.error("Error fetching group page:", error);
                    // Rethrow with more context
                    throw new Error(`ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ ØµÙØ­Ø© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª: ${error.message}`);
                }
            }
            allGroups = groups; // Assign the final list
        }


        // --- ÙˆØ¸Ø§Ø¦Ù ÙÙ„ØªØ±Ø© ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª ---

        groupFilterInput.addEventListener('input', function() {
            currentPage = 1; // Reset to first page on filter change
            updateFilteredGroups();
            showPage(currentPage);
        });

        function updateFilteredGroups() {
            const filterText = groupFilterInput.value.trim().toLowerCase();
            if (filterText === '') {
                filteredGroups = [...allGroups];
            } else {
                filteredGroups = allGroups.filter(group =>
                    group.name.toLowerCase().includes(filterText)
                );
            }

            if (allGroups.length > 0) {
               groupCounter.textContent = `Ø¹Ø±Ø¶ ${filteredGroups.length} Ù…Ù† ${allGroups.length} Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„ÙÙ„ØªØ±.`;
            } else if (!isLoadingGroups) {
               groupCounter.textContent = `Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø£ÙŠ Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø¨Ø¹Ø¯.`;
            }

            updatePagination();
        }

        function updatePagination() {
            const pageCount = Math.ceil(filteredGroups.length / groupsPerPage);
            groupsPagination.innerHTML = ''; // Clear existing buttons

            if (pageCount <= 1) return; // No pagination needed for 0 or 1 page

            function createPageButton(text, pageNum, isDisabled = false, isActive = false) {
                const btn = document.createElement('button');
                btn.className = 'page-btn';
                btn.textContent = text;
                btn.disabled = isDisabled;
                if (isActive) btn.classList.add('active');
                if (!isDisabled && pageNum) {
                    btn.addEventListener('click', () => showPage(pageNum));
                }
                return btn;
            }

             function createEllipsis() {
                const span = document.createElement('span');
                span.textContent = '...';
                return span;
            }

            // Previous Button
            groupsPagination.appendChild(createPageButton('Â« Ø§Ù„Ø³Ø§Ø¨Ù‚', currentPage - 1, currentPage === 1));

            // Page Number Buttons (with ellipsis logic)
            const maxVisiblePages = 3; // Max numeric buttons shown around current page
            let startPage, endPage;

             if (pageCount <= maxVisiblePages + 2) { // Show all if not too many pages
                startPage = 1;
                endPage = pageCount;
            } else {
                if (currentPage <= Math.ceil(maxVisiblePages / 2) + 1) {
                    startPage = 1;
                    endPage = maxVisiblePages;
                    groupsPagination.appendChild(createPageButton(1, 1, false, currentPage === 1));
                    for (let i = 2; i <= endPage; i++) {
                         groupsPagination.appendChild(createPageButton(i, i, false, currentPage === i));
                    }
                    groupsPagination.appendChild(createEllipsis());
                    groupsPagination.appendChild(createPageButton(pageCount, pageCount));
                } else if (currentPage >= pageCount - Math.floor(maxVisiblePages / 2)) {
                    startPage = pageCount - maxVisiblePages + 1;
                    endPage = pageCount;
                    groupsPagination.appendChild(createPageButton(1, 1));
                    groupsPagination.appendChild(createEllipsis());
                    for (let i = startPage; i <= endPage; i++) {
                         groupsPagination.appendChild(createPageButton(i, i, false, currentPage === i));
                    }
                } else {
                    startPage = currentPage - Math.floor(maxVisiblePages / 2);
                    endPage = currentPage + Math.floor(maxVisiblePages / 2);
                     groupsPagination.appendChild(createPageButton(1, 1));
                     groupsPagination.appendChild(createEllipsis());
                     for (let i = startPage; i <= endPage; i++) {
                         groupsPagination.appendChild(createPageButton(i, i, false, currentPage === i));
                    }
                    groupsPagination.appendChild(createEllipsis());
                    groupsPagination.appendChild(createPageButton(pageCount, pageCount));
                }
            }


            // Next Button
            groupsPagination.appendChild(createPageButton('Ø§Ù„ØªØ§Ù„ÙŠ Â»', currentPage + 1, currentPage === pageCount));
        }

        function showPage(pageNum) {
            currentPage = pageNum;
            const startIndex = (pageNum - 1) * groupsPerPage;
            const endIndex = Math.min(startIndex + groupsPerPage, filteredGroups.length);
            // Get the slice of groups for the current page
            currentVisibleGroups = filteredGroups.slice(startIndex, endIndex);

            groupsContainer.innerHTML = ''; // Clear previous content

            if (currentVisibleGroups.length === 0) {
                if (allGroups.length > 0) {
                    groupsContainer.innerHTML = '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¬Ù…ÙˆØ¹Ø§Øª ØªØ·Ø§Ø¨Ù‚ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø­Ø§Ù„ÙŠØ©.</p>';
                } else if (!isLoadingGroups) {
                    groupsContainer.innerHTML = '<p>Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø£ÙŠ Ù…Ø¬Ù…ÙˆØ¹Ø§Øª. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø²Ø± "ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª".</p>';
                }
                // If loading, the loading indicator is already shown
            } else {
                // Get IDs of groups currently selected for posting
                const selectedPostingGroupIds = new Set(currentlySelectedGroupsForPosting.map(g => g.id));

                currentVisibleGroups.forEach(group => {
                    const groupItem = document.createElement('div');
                    groupItem.className = 'group-item';

                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.value = group.id;
                    checkbox.id = `group_${group.id}`;
                    checkbox.dataset.name = group.name;
                    // Check if this group is in the list selected for the *next* posting operation
                    checkbox.checked = selectedPostingGroupIds.has(group.id);
                    checkbox.addEventListener('change', handleGroupSelectionChange); // Add listener

                    const label = document.createElement('label');
                    label.htmlFor = `group_${group.id}`;
                    label.textContent = group.name; // Display name only

                    groupItem.appendChild(checkbox);
                    groupItem.appendChild(label);
                    groupsContainer.appendChild(groupItem);
                });
            }

            updatePagination(); // Refresh pagination buttons
        }

        // --- ÙˆØ¸Ø§Ø¦Ù ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª ---

        function handleGroupSelectionChange(event) {
             const checkbox = event.target;
             const groupId = checkbox.value;
             const groupName = checkbox.dataset.name;

             if (checkbox.checked) {
                 // Add to the list if not already present
                 if (!currentlySelectedGroupsForPosting.some(g => g.id === groupId)) {
                     currentlySelectedGroupsForPosting.push({ id: groupId, name: groupName });
                 }
             } else {
                 // Remove from the list
                 currentlySelectedGroupsForPosting = currentlySelectedGroupsForPosting.filter(g => g.id !== groupId);
             }
             // Optional: Update a counter for selected groups if needed
             // console.log("Selected for posting:", currentlySelectedGroupsForPosting.length);
        }

        selectAllBtn.addEventListener('click', function() {
             // Select only the groups currently visible on the page
            const checkboxes = groupsContainer.querySelectorAll('input[type="checkbox"]');
            let countAdded = 0;
            checkboxes.forEach(checkbox => {
                if (!checkbox.checked) {
                     checkbox.checked = true;
                     // Trigger the change handler to add to the main list
                     handleGroupSelectionChange({ target: checkbox });
                     countAdded++;
                }
            });
            if (countAdded > 0) {
                 showStatus(`ØªÙ… ØªØ­Ø¯ÙŠØ¯ ${countAdded} Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¥Ø¶Ø§ÙÙŠØ© ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©. Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø­Ø¯Ø¯ Ù„Ù„Ù†Ø´Ø±: ${currentlySelectedGroupsForPosting.length}.`, 'info');
            }
        });

        deselectAllBtn.addEventListener('click', function() {
             // Deselect only the groups currently visible on the page
            const checkboxes = groupsContainer.querySelectorAll('input[type="checkbox"]');
             let countRemoved = 0;
            checkboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    checkbox.checked = false;
                    // Trigger the change handler to remove from the main list
                    handleGroupSelectionChange({ target: checkbox });
                     countRemoved++;
                }
            });
             if (countRemoved > 0) {
                 showStatus(`ØªÙ… Ø¥Ù„ØºØ§Ø¡ ØªØ­Ø¯ÙŠØ¯ ${countRemoved} Ù…Ø¬Ù…ÙˆØ¹Ø© ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©. Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø­Ø¯Ø¯ Ù„Ù„Ù†Ø´Ø±: ${currentlySelectedGroupsForPosting.length}.`, 'info');
            }
        });


        // --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù†Ø´Ø± ---

        publishBtn.addEventListener('click', async function() {
            const token = accessTokenInput.value;
            let content = postContentInput.value.trim();
            const imageFile = imageUpload.files[0];
            const postType = postTypeSelect.value;
            const scheduleDate = scheduleDateInput.value;
            const scheduleTime = scheduleTimeInput.value;

            // --- Validations ---
            if (!token) { showStatus('<strong>Ø®Ø·Ø£:</strong> ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ÙˆØµÙˆÙ„.', 'error'); return; }
            if (!content && !imageFile) { showStatus('<strong>Ø®Ø·Ø£:</strong> ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø­ØªÙˆÙ‰ Ù†ØµÙŠ Ø£Ùˆ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø©.', 'error'); return; }
            if (currentlySelectedGroupsForPosting.length === 0) { showStatus('<strong>Ø®Ø·Ø£:</strong> ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ù…Ø¬Ù…ÙˆØ¹Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„Ù†Ø´Ø± ÙÙŠÙ‡Ø§.', 'error'); return; }
            if (postType === 'schedule' && (!scheduleDate || !scheduleTime)) { showStatus('<strong>Ø®Ø·Ø£:</strong> ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ ØªØ§Ø±ÙŠØ® ÙˆÙˆÙ‚Øª Ø¨Ø¯Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø©.', 'error'); return; }
            if (parseInt(minIntervalInput.value) >= parseInt(maxIntervalInput.value)) { showStatus('<strong>Ø®Ø·Ø£:</strong> Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„ÙØ§ØµÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£Ù‚Ù„ Ù…Ù† Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰.', 'error'); return; }
             if (parseInt(minIntervalInput.value) < 5 || parseInt(maxIntervalInput.value) < 5) { showStatus('<strong>Ø®Ø·Ø£:</strong> ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„ÙØ§ØµÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ 5 Ø¯Ù‚Ø§Ø¦Ù‚ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.', 'error'); return; }


            // --- Confirmation for large number ---
            if (currentlySelectedGroupsForPosting.length > 30) { // Reduced threshold for warning
                if (!confirm(`âš ï¸ ØªØ­Ø°ÙŠØ± Ø´Ø¯ÙŠØ¯ âš ï¸\n\nØ£Ù†Øª Ø¹Ù„Ù‰ ÙˆØ´Ùƒ Ø§Ù„Ù†Ø´Ø± ÙÙŠ ${currentlySelectedGroupsForPosting.length} Ù…Ø¬Ù…ÙˆØ¹Ø©.\n\nØ§Ù„Ù†Ø´Ø± ÙÙŠ Ø¹Ø¯Ø¯ ÙƒØ¨ÙŠØ± Ø¬Ø¯Ù‹Ø§ Ù…Ù† Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§ØªØŒ Ø­ØªÙ‰ Ù…Ø¹ ÙˆØ¬ÙˆØ¯ ÙÙˆØ§ØµÙ„ Ø²Ù…Ù†ÙŠØ©ØŒ ÙŠØ­Ù…Ù„ Ø®Ø·Ø±Ù‹Ø§ Ø¹Ø§Ù„ÙŠÙ‹Ø§ Ø¬Ø¯Ù‹Ø§ Ù„ØªÙ‚ÙŠÙŠØ¯ Ø­Ø³Ø§Ø¨Ùƒ Ø£Ùˆ Ø­Ø¸Ø±Ù‡ Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© ÙÙŠØ³Ø¨ÙˆÙƒ.\n\nÙ‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ ØªÙ…Ø§Ù…Ù‹Ø§ ÙˆØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø¹Ù„Ù‰ Ù…Ø³Ø¤ÙˆÙ„ÙŠØªÙƒ Ø§Ù„ÙƒØ§Ù…Ù„Ø©ØŸ`)) {
                    return;
                }
                showStatus(`ØªÙ… ØªØ­Ø¯ÙŠØ¯ ${currentlySelectedGroupsForPosting.length} Ù…Ø¬Ù…ÙˆØ¹Ø©. Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø¹Ù„Ù‰ Ù…Ø³Ø¤ÙˆÙ„ÙŠØªÙƒ Ø§Ù„ÙƒØ§Ù…Ù„Ø©. Ø±Ø§Ù‚Ø¨ Ø­Ø³Ø§Ø¨Ùƒ.`, 'warning');
            } else {
                 showStatus(`Ø¬Ø§Ø±ÙŠ ØªØ­Ø¶ÙŠØ± Ø§Ù„Ù†Ø´Ø± Ù„Ù€ ${currentlySelectedGroupsForPosting.length} Ù…Ø¬Ù…ÙˆØ¹Ø©...`, 'info');
            }

            // --- Prepare for Posting ---
            // Clone the selected groups array for this specific posting operation
            const groupsToPost = [...currentlySelectedGroupsForPosting];

            if (postingModeSelect.value === 'random') {
                shuffleArray(groupsToPost);
            }

            isPosting = true;
            stopPostingFlag = false;
            currentGroupIndex = 0;
            postCountSincePause = 0;
            disableForm(true); // Disable form elements
            stopBtn.style.display = 'inline-block';
            progressContainer.style.display = 'block';
            updateProgress(0, groupsToPost.length);

            // --- Handle Scheduling vs Immediate Start ---
             if (postType === 'schedule') {
                 const scheduleDateTime = new Date(`${scheduleDate}T${scheduleTime}`);
                 const now = new Date();
                 const delayMillis = scheduleDateTime.getTime() - now.getTime();
                 const minDelayMillis = 10 * 60 * 1000 - 1000; // 10 minutes minus a second tolerance

                 if (delayMillis <= minDelayMillis) {
                     showStatus('<strong>Ø®Ø·Ø£:</strong> ÙˆÙ‚Øª Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯ ÙÙŠ Ø§Ù„Ù…Ø§Ø¶ÙŠ Ø£Ùˆ Ù‚Ø±ÙŠØ¨ Ø¬Ø¯Ù‹Ø§ (ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨Ø¹Ø¯ 10 Ø¯Ù‚Ø§Ø¦Ù‚ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„).', 'error');
                     disableForm(false); // Re-enable form
                     stopBtn.style.display = 'none';
                     progressContainer.style.display = 'none';
                     isPosting = false;
                     return;
                 }

                 showStatus(`ØªÙ… Ø¬Ø¯ÙˆÙ„Ø© Ø¨Ø¯Ø¡ Ø§Ù„Ù†Ø´Ø± ÙÙŠ ${scheduleDateTime.toLocaleString('ar-EG')}. Ø§Ù„Ù†Ø´Ø± Ø³ÙŠØªÙ… Ù„Ù€ ${groupsToPost.length} Ù…Ø¬Ù…ÙˆØ¹Ø©.`, 'success');
                 startCountdownTimer(Math.floor(delayMillis / 1000));

                 timeoutId = setTimeout(() => {
                     if (!stopPostingFlag) {
                         showStatus(`â° Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ù†Ø´Ø± Ø§Ù„Ù…Ø¬Ø¯ÙˆÙ„Ø© Ù„Ù€ ${groupsToPost.length} Ù…Ø¬Ù…ÙˆØ¹Ø©...`, 'info');
                         postToNextGroup(groupsToPost); // Pass the specific list for this run
                     } else {
                         showStatus('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù†Ø´Ø± Ø§Ù„Ù…Ø¬Ø¯ÙˆÙ„ Ù‚Ø¨Ù„ Ø§Ù„Ø¨Ø¯Ø¡.', 'warning');
                         // Reset UI handled by stop button logic
                     }
                 }, delayMillis);

             } else {
                 showStatus(`ğŸš€ Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ù†Ø´Ø± Ø§Ù„Ø¢Ù† Ù„Ù€ ${groupsToPost.length} Ù…Ø¬Ù…ÙˆØ¹Ø©...`, 'info');
                 postToNextGroup(groupsToPost); // Pass the specific list for this run
             }
        });

         stopBtn.addEventListener('click', function() {
            if (!isPosting) return; // Do nothing if not posting

            stopPostingFlag = true; // Signal to stop loops/timeouts
            isPosting = false;
            clearTimeout(timeoutId); // Clear any pending post/pause timeout
            clearInterval(countdownInterval); // Stop any active countdown
            timerDisplay.style.display = 'none';

            showStatus('âš ï¸ ØªÙ… Ø·Ù„Ø¨ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù†Ø´Ø±. Ø¬Ø§Ø±ÙŠ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª...', 'warning');
            stopBtn.disabled = true; // Prevent multiple clicks

            // Re-enable the form and reset UI elements after a short delay
            // to allow any ongoing fetch to potentially abort (though fetch isn't truly abortable this way)
            setTimeout(() => {
                disableForm(false);
                stopBtn.style.display = 'none';
                stopBtn.disabled = false; // Re-enable for future use
                // Keep progress bar potentially visible to show where it stopped
                // progressContainer.style.display = 'none';
                showStatus('ğŸ›‘ ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ù†Ø´Ø±.', 'error');
            }, 1500);
        });


        async function postToNextGroup(groupsList) { // Takes the list for this specific run
            if (stopPostingFlag || currentGroupIndex >= groupsList.length) {
                // --- Posting Finished or Stopped ---
                if (!stopPostingFlag && isPosting) { // Finished normally
                    showStatus(`âœ… Ø§ÙƒØªÙ…Ù„ Ø§Ù„Ù†Ø´Ø± Ø¨Ù†Ø¬Ø§Ø­ ÙÙŠ ${currentGroupIndex} Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…Ù† ${groupsList.length}.`, 'success');
                } else if (stopPostingFlag) { // Stopped by user
                     // Status already shown by stop button handler or updated during stop
                }

                // --- Final UI Reset ---
                isPosting = false; // Ensure posting state is false
                stopPostingFlag = false; // Reset flag
                disableForm(false); // Re-enable form for next use
                stopBtn.style.display = 'none'; // Hide stop button
                // Optionally hide progress after completion/stop
                // progressContainer.style.display = 'none';
                 clearTimeout(timeoutId); // Clear any final stray timeouts
                 clearInterval(countdownInterval); // Clear any final stray countdowns
                 timerDisplay.style.display = 'none'; // Hide timer display
                return; // Exit the loop
            }

            const currentGroup = groupsList[currentGroupIndex];

             // --- Safety Pause Check ---
             if (pauseOptionCheckbox.checked && postCountSincePause > 0 && postCountSincePause % 5 === 0) {
                 const pauseMinutes = 60;
                 showStatus(`ğŸ›¡ï¸ Ø£Ù…Ø§Ù†: Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª Ù„Ù…Ø¯Ø© ${pauseMinutes} Ø¯Ù‚ÙŠÙ‚Ø© Ø¨Ø¹Ø¯ Ù†Ø´Ø± 5 Ù…Ù†Ø´ÙˆØ±Ø§Øª. Ø§Ù„Ø§Ø³ØªØ¦Ù†Ø§Ù ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹...`, 'warning');
                 startCountdownTimer(pauseMinutes * 60);

                 timeoutId = setTimeout(() => {
                     if (!stopPostingFlag && isPosting) { // Check flags before resuming
                         postCountSincePause = 0; // Reset counter after pause
                         showStatus(`â–¶ï¸ Ø§Ø³ØªØ¦Ù†Ø§Ù Ø§Ù„Ù†Ø´Ø± Ø¨Ø¹Ø¯ Ø§Ù„ØªÙˆÙ‚Ù Ø§Ù„Ù…Ø¤Ù‚Øª Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©: ${currentGroup.name}`, 'info');
                         postToGroupAndProceed(currentGroup, groupsList); // Post to current group then proceed
                     }
                 }, pauseMinutes * 60 * 1000);
                 return; // Wait for the pause timeout
             }

             // --- No Pause Needed, Post Directly ---
              postToGroupAndProceed(currentGroup, groupsList);
        }


        async function postToGroupAndProceed(group, groupsList) {
             if (stopPostingFlag || !isPosting) return; // Double check before API call

             showStatus(`â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù†Ø´Ø± ÙÙŠ (${currentGroupIndex + 1}/${groupsList.length}): ${group.name}...`, 'info');
             updateProgress(currentGroupIndex + 1, groupsList.length); // Update progress before posting

             const postSuccess = await postToGroupAPI(group); // Perform the API call

             // --- After Post Attempt (Success or Fail) ---
              if (stopPostingFlag || !isPosting) return; // Check again if stopped during API call

              currentGroupIndex++;
              if (postSuccess) { // Only increment pause counter on success? Or on attempt? Let's do attempt.
                    postCountSincePause++;
              }

              // --- Schedule Next Post ---
              if (currentGroupIndex < groupsList.length) {
                 const minDelayMinutes = parseInt(minIntervalInput.value) || 5;
                 const maxDelayMinutes = parseInt(maxIntervalInput.value) || 15;
                 // Ensure max is greater than min
                 const actualMax = Math.max(minDelayMinutes + 1, maxDelayMinutes);
                 const delayMinutes = Math.random() * (actualMax - minDelayMinutes) + minDelayMinutes;
                 const delayMillis = delayMinutes * 60 * 1000;

                 showStatus(`ğŸ‘ ØªÙ… Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ ${group.name}. Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± ${delayMinutes.toFixed(1)} Ø¯Ù‚ÙŠÙ‚Ø© Ù„Ù„Ù†Ø´Ø± Ø§Ù„ØªØ§Ù„ÙŠ...`, 'info');
                 startCountdownTimer(Math.floor(delayMillis / 1000));

                 timeoutId = setTimeout(() => {
                     if (!stopPostingFlag && isPosting) { // Check flags before next post
                         postToNextGroup(groupsList); // Call for the next group
                     }
                 }, delayMillis);
              } else {
                  // Last group was processed, call postToNextGroup to trigger completion logic
                  postToNextGroup(groupsList);
              }
        }


        async function postToGroupAPI(group) {
            const token = accessTokenInput.value;
            let baseContent = postContentInput.value.trim(); // Original content
            const imageFile = imageUpload.files[0];
            const randomize = randomizeContentCheckbox.checked;
            let success = false;

            // --- Prepare Content ---
             // Replace placeholder {Ø§Ø³Ù…_Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©}
             let finalContent = baseContent.replace(/{Ø§Ø³Ù…_Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©}/g, group.name);

             // Randomize (simple)
             if (randomize && finalContent) {
                 const variations = ['\u200B', '\u200C', '\u200D', ' ']; // Zero-width spaces, regular space
                 finalContent += variations[Math.floor(Math.random() * variations.length)];
             }


            const apiUrlBase = `https://graph.facebook.com/${API_VERSION}/${group.id}`;
            let apiUrl;
            let requestOptions = {
                method: 'POST',
                headers: {},
                body: null
            };

            try {
                if (imageFile) {
                    // --- Post Photo ---
                    apiUrl = `${apiUrlBase}/photos`;
                    const formData = new FormData();
                    formData.append('access_token', token);
                    if (finalContent) {
                        formData.append('caption', finalContent);
                    }
                    formData.append('source', imageFile);
                     // If scheduling is needed for photos, FB often requires using specific ad/business APIs,
                     // simpler APIs might not support direct photo scheduling easily. Assuming immediate post here.
                     // formData.append('published', 'true'); // Explicitly publish now

                    requestOptions.body = formData;
                    // Content-Type is set automatically by browser for FormData

                } else if (finalContent) {
                    // --- Post Feed (Text) ---
                    apiUrl = `${apiUrlBase}/feed`;
                    const params = {
                        access_token: token,
                        message: finalContent
                    };
                    // Note: Scheduling text posts via /feed with scheduled_publish_time might work,
                    // but was not fully implemented in the UI logic flow (UI schedules the *start*).
                    // params.published = true; // Explicitly publish now if not scheduling via API

                    requestOptions.headers['Content-Type'] = 'application/x-www-form-urlencoded'; // Often preferred for simple feed posts
                     requestOptions.body = new URLSearchParams(params).toString(); // Encode params correctly

                } else {
                    console.warn(`No content (text/image) to post in group: ${group.name}`);
                    showStatus(`âš ï¸ ØªØ®Ø·ÙŠ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© ${group.name}: Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø­ØªÙˆÙ‰ Ù†ØµÙŠ Ø£Ùˆ ØµÙˆØ±Ø©.`, 'warning');
                    return false; // Indicate failure/skip for this group
                }

                // --- Make API Call ---
                const response = await fetch(apiUrl, requestOptions);
                const result = await response.json();

                if (!response.ok || result.error) {
                    const error = result.error || { code: 'HTTP'+response.status, message: response.statusText };
                    const errorMessage = `(${error.code}) ${error.message || 'Unknown API Error'}`;
                    console.error(`Failed to post to ${group.name}: ${errorMessage}`, result);
                    showStatus(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ø´Ø± Ø¨Ù€ ${group.name}: ${errorMessage}. Ù‚Ø¯ ØªÙƒÙˆÙ† Ø¨Ø³Ø¨Ø¨ Ø§Ù„Ø£Ø°ÙˆÙ†Ø§Øª Ø£Ùˆ Ù‚ÙŠÙˆØ¯ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©.`, 'error');
                    success = false;
                    // Specific error handling examples:
                    if (error.code === 200) { // Permissions error
                         // Maybe stop the whole process if permissions are globally missing?
                    } else if (error.code === 10) { // Permission Denied - Group specific?
                         // Just log and continue
                    } else if (error.code === 368) { // Temporarily blocked
                         showStatus(`ğŸš« Ø­Ø³Ø§Ø¨Ùƒ Ù…Ø­Ø¸ÙˆØ± Ù…Ø¤Ù‚ØªÙ‹Ø§ Ø¹Ù† Ø§Ù„Ù†Ø´Ø± Ø¨Ø³Ø¨Ø¨ Ù†Ø´Ø§Ø· Ù…ÙØ±Ø·. ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¹Ù…Ù„ÙŠØ©.`, 'error');
                         stopPostingFlag = true; // Stop the whole process
                         isPosting = false;
                    }
                } else {
                    console.log(`Successfully posted to ${group.name}:`, result);
                    // Success status is handled by the calling function ('ØªÙ… Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹...')
                    success = true;
                }

            } catch (error) {
                console.error(`Network/Fetch error posting to ${group.name}:`, error);
                showStatus(` à¦¨à§‡à¦Ÿà¦“à§Ÿà¦¾à¦°à§à¦• à¦¤à§à¦°à§à¦Ÿà¦¿ Ø£Ùˆ Ø®Ø·Ø£ ØªÙ‚Ù†ÙŠ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù†Ø´Ø± ÙÙŠ ${group.name}: ${error.message}`, 'error');
                success = false;
                 // Consider stopping if network fails repeatedly
            }
            return success;
        }

        // --- Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© ---

        postTypeSelect.addEventListener('change', function() {
            scheduleOptions.style.display = (this.value === 'schedule') ? 'block' : 'none';
        });

        imageUpload.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    uploadedImage.src = event.target.result;
                    uploadedImage.style.display = 'block';
                }
                reader.readAsDataURL(file);
            } else {
                uploadedImage.src = '';
                uploadedImage.style.display = 'none';
                 if (file) { // If a file was selected but wasn't an image
                      showStatus('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù ØµÙˆØ±Ø© ØµØ§Ù„Ø­ (png, jpg, gif).', 'warning');
                      imageUpload.value = ''; // Clear the invalid selection
                 }
            }
        });

        // --- ØªÙ‡ÙŠØ¦Ø© Ø£ÙˆÙ„ÙŠØ© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© ---
        function initializeApp() {
            scheduleOptions.style.display = 'none';
            stopBtn.style.display = 'none';
            progressContainer.style.display = 'none';
            groupSearchContainer.style.display = 'none';
            groupLoadingOptions.style.display = 'none';
            groupsContainer.innerHTML = '<p>Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ÙˆØµÙˆÙ„ ÙˆØ§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ "ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª".</p>';
             currentlySelectedGroupsForPosting = []; // Clear selection on load
        }

        // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰
        document.addEventListener('DOMContentLoaded', initializeApp);

    </script>

</body>
</html>
